I"Œ@<p><code class="language-plaintext highlighter-rouge">If-Then</code> is VBA‚Äôs most important control structure. You‚Äôll probably use this command on a daily basis.</p>

<p>As in many other aspects of life, effective <em>decision-making</em> is the key to success in writing CAD or any other macros.</p>

<p>The <code class="language-plaintext highlighter-rouge">If-Then</code> structure has this basic syntax:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">If</span> <span class="n">condition</span> <span class="k">Then</span> <span class="n">statements</span> <span class="err">[</span><span class="k">Else</span> <span class="n">elsestatements</span><span class="err">]</span>
</code></pre></div></div>

<p>Use the <strong>If-Then</strong> structure when you want to execute one or more statements conditionally.</p>

<p>The optional <strong>Else</strong> clause, if included, lets you execute one or more statements if the condition you‚Äôre testing is not true.</p>

<p>Sound confusing? Don‚Äôt worry; a few examples make this crystal clear.</p>

<h2 id="if-then-examples">If-Then examples</h2>

<p>The following routine demonstrates the <code class="language-plaintext highlighter-rouge">If-Then</code> structure without the optional Else clause:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Sub</span> <span class="nf">GoodMorning</span><span class="p">()</span>
  <span class="k">If</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">Then</span> <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span> <span class="n">Morning</span><span class="p">.</span><span class="err">‚Äù</span>
<span class="n">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">GoodMorning</code> procedure uses VBA‚Äôs <code class="language-plaintext highlighter-rouge">Time</code> function to get the system time.</p>

<p>If the current system time is less than <em>.5</em> (in other words, before noon), the routine displays a friendly greeting.</p>

<p>If Time is greater than or equal to <em>.5</em>, the routine ends and nothing happens.</p>

<p>To display a different greeting if Time is greater than or equal to <em>.5</em>, add another <em>If-Then</em> statement after the first one:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Sub</span> <span class="nf">GoodMorning2</span><span class="p">()</span>
  <span class="k">If</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">Then</span> <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span> <span class="n">Morning</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">If</span> <span class="n">Time</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">Then</span> <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span> <span class="n">Afternoon</span><span class="p">.</span><span class="err">‚Äù</span>
<span class="n">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>Notice that I used <code class="language-plaintext highlighter-rouge">&gt;=</code> (greater than or equal to) for the second <em>If-Then</em> statement.</p>

<p>This ensures that the entire day is covered. Had I used <code class="language-plaintext highlighter-rouge">&gt;</code> (greater than), then no message would appear if this procedure were executed at precisely 12:00 noon.</p>

<h2 id="if-then-else-examples">If-Then-Else examples</h2>

<p>Another approach to the preceding problem uses the <code class="language-plaintext highlighter-rouge">Else</code> clause.</p>

<p>Here‚Äôs the same routine recoded to use the <code class="language-plaintext highlighter-rouge">If-Then-Else</code> structure:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Sub</span> <span class="nf">GoodMorning3</span><span class="p">()</span>
  <span class="k">If</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">Then</span> <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span> <span class="n">Morning</span><span class="p">.</span><span class="err">‚Äù</span> <span class="n">Else</span> <span class="n">_</span>
  <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span> <span class="n">Afternoon</span><span class="p">.</span><span class="err">‚Äù</span>
<span class="n">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>Notice that I use the <em>line continuation character (underscore)</em> in the preceding example.</p>

<p>The <strong>If-Then-Else</strong> statement is actually a single statement.</p>

<p>VBA provides a slightly different way of coding <strong>If-Then-Else</strong> constructs that use an <strong>End-If</strong> statement.</p>

<p>Therefore, the <code class="language-plaintext highlighter-rouge">GoodMorning</code> procedure can be rewritten as:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Sub</span> <span class="nf">GoodMorning4</span><span class="p">()</span>
  <span class="k">If</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">Then</span>
    <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span> <span class="n">Morning</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">Else</span>
    <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span> <span class="n">Afternoon</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">End</span> <span class="k">If</span>
<span class="k">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>In fact, you can insert any number of statements under the <code class="language-plaintext highlighter-rouge">If</code> part, and any number of statements under the <code class="language-plaintext highlighter-rouge">Else</code> part.</p>

<p>I prefer to use this syntax because it‚Äôs easier to read and makes the statements shorter.</p>

<p>What if you need to expand the <code class="language-plaintext highlighter-rouge">GoodMorning</code> routine to handle three conditions: <em>morning, afternoon, and evening</em>?</p>

<p>You have two options: Use three <code class="language-plaintext highlighter-rouge">If-Then</code> statements or use a nested <code class="language-plaintext highlighter-rouge">If-Then-Else</code> structure.</p>

<p><strong>Nesting</strong> means placing an <strong>If-Then-Else</strong> structure within another <strong>If-Then-Else</strong> structure.</p>

<p>The first approach, the three statements, is simplest:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Sub</span> <span class="nf">GoodMorning5</span><span class="p">()</span>
  <span class="k">If</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">Then</span> <span class="n">Msg</span> <span class="o">=</span> <span class="err">‚Äú</span><span class="n">Morning</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">If</span> <span class="n">Time</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="ow">And</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="k">Then</span> <span class="n">Msg</span> <span class="o">=</span> <span class="err">‚Äú</span><span class="n">Afternoon</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">If</span> <span class="n">Time</span> <span class="o">&gt;=</span> <span class="mf">0.75</span> <span class="k">Then</span> <span class="n">Msg</span> <span class="o">=</span> <span class="err">‚Äú</span><span class="n">Evening</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span><span class="err">‚Äù</span> <span class="o">&amp;</span> <span class="n">Msg</span>
<span class="k">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Msg</code> variable gets a different text value, depending on the time of day.</p>

<p>The final <code class="language-plaintext highlighter-rouge">MsgBox</code> statement displays the greeting: <em>Good Morning, Good Afternoon, or Good Evening</em>.</p>

<p>The following routine performs the same action but uses an <strong>If-Then-End If</strong> structure:</p>

<pre><code class="language-VB">Sub GoodMorning6()
  Dim Msg As String
  If Time &lt; 0.5 Then
    Msg = ‚ÄúMorning.‚Äù
  If Time &gt;= 0.5 And Time &lt; 0.75 Then
    Msg = ‚ÄúAfternoon.‚Äù
  If Time &gt;= 0.75 Then
    Msg = ‚ÄúEvening.‚Äù
  End If
  MsgBox ‚ÄúGood‚Äù &amp; Msg
End Sub
</code></pre>

<h2 id="if-elseif-else-examples">If-ElseIf-Else examples</h2>

<p>In the previous examples, every statement in the routine is executed ‚Äî even in the morning.</p>

<p>A more efficient structure would exit the routine as soon as a condition is found to be true.</p>

<p>In the morning, for example, the procedure should display the Good Morning message and then exit ‚Äî without evaluating the other <em>superfluous</em> conditions.</p>

<p>With a tiny routine like this, you don‚Äôt have to worry about execution speed.</p>

<p>But for larger applications in which speed is important, you should know about another syntax for the If-Then structure.</p>

<p>The <code class="language-plaintext highlighter-rouge">ElseIf</code> syntax follows:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">If</span> <span class="n">condition</span> <span class="k">Then</span>
<span class="err">[</span><span class="n">statements</span><span class="err">]</span>
<span class="err">[</span><span class="k">Else</span> <span class="n">condition</span><span class="o">-</span><span class="n">n</span> <span class="k">Then</span>
<span class="err">[</span><span class="n">elseifstatements</span><span class="err">]]</span>
<span class="err">[</span><span class="k">Else</span>
<span class="err">[</span><span class="n">elsestatements</span><span class="err">]]</span>
</code></pre></div></div>

<p>Here‚Äôs how you can rewrite the <code class="language-plaintext highlighter-rouge">GreetMe</code> routine by using this syntax:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Sub</span> <span class="nf">GoodMorning7</span><span class="p">()</span>
  <span class="k">Dim</span> <span class="nv">Msg</span> <span class="ow">As</span> <span class="kt">String</span>
  <span class="k">If</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">Then</span>
    <span class="n">Msg</span> <span class="o">=</span> <span class="err">‚Äú</span><span class="n">Morning</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">ElseIf</span> <span class="n">Time</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="ow">And</span> <span class="n">Time</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="k">Then</span>
    <span class="n">Msg</span> <span class="o">=</span> <span class="err">‚Äú</span><span class="n">Afternoon</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">Else</span>
    <span class="n">Msg</span> <span class="o">=</span> <span class="err">‚Äú</span><span class="n">Evening</span><span class="p">.</span><span class="err">‚Äù</span>
  <span class="n">End</span> <span class="k">If</span>
  <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Good</span><span class="err">‚Äù</span> <span class="o">&amp;</span> <span class="n">Msg</span>
<span class="k">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>When a condition is <code class="language-plaintext highlighter-rouge">true</code>, VBA executes the conditional statements and the If structure ends.</p>

<p>In other words, VBA doesn‚Äôt waste time evaluating the extraneous conditions, which makes this procedure a bit more efficient than the previous examples.</p>

<p>The trade-off (there are always trade-offs) is that the code is more difficult to understand. (Of course, you already knew that.)</p>

<h1 id="select-case-structure">Select Case structure</h1>

<p>The <code class="language-plaintext highlighter-rouge">Select</code> Case structure is useful for decisions involving three or more options (although it also works with two options, but using <strong>If-Then-Else</strong> structure is more efficient for that).</p>

<p>The syntax for the <code class="language-plaintext highlighter-rouge">Select</code> Case structure follows:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Select</span> <span class="k">Case</span> <span class="n">testexpression</span>
<span class="err">[</span><span class="k">Case</span> <span class="n">expressionlist</span><span class="o">-</span><span class="n">n</span> 
  <span class="err">[</span><span class="n">statements</span><span class="o">-</span><span class="n">n</span><span class="err">]]</span>
<span class="err">[</span><span class="k">Case</span> <span class="k">Else</span>
  <span class="err">[</span><span class="n">elsestatements</span><span class="err">]]</span>
<span class="k">End</span> <span class="k">Select</span>
</code></pre></div></div>

<p>Don‚Äôt be scared off by this official syntax. Using the <strong>Select Case structure</strong> is quite easy.</p>

<h2 id="select-case-example">Select Case example</h2>

<p>The following example shows how to use the <strong>Select Case structure</strong>.</p>

<p>This also shows another way to code the examples presented in the previous section:</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Sub</span> <span class="nf">SelectPartLength</span><span class="p">()</span>
  <span class="k">Dim</span> <span class="nv">PartNumber</span> <span class="ow">As</span> <span class="kt">Integer</span>
  <span class="k">Dim</span> <span class="nv">PartLength</span> <span class="ow">As</span> <span class="kt">Integer</span>
  <span class="n">PartNumber</span> <span class="o">=</span> <span class="n">InputBox</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">Please</span> <span class="n">Enter</span> <span class="n">part</span> <span class="n">number</span><span class="p">:</span><span class="err">‚Äù</span><span class="p">)</span>
  <span class="k">Select</span> <span class="k">Case</span> <span class="n">PartNumber</span>
    <span class="k">Case</span> <span class="n">Part001</span>
      <span class="n">PartLength</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">Case</span> <span class="n">Part002</span>
      <span class="n">PartLength</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">Case</span> <span class="n">Part003</span>
      <span class="n">PartLength</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="k">End</span> <span class="k">Select</span>
  <span class="n">MsgBox</span> <span class="err">‚Äú</span><span class="n">Part</span> <span class="n">Length</span> <span class="n">for</span> <span class="n">this</span><span class="err">‚Äù</span> <span class="o">&amp;</span> <span class="n">PartNumber</span> <span class="o">&amp;</span> <span class="err">‚Äú</span><span class="n">is</span><span class="err">‚Äù</span> <span class="o">&amp;</span> <span class="n">PartLength</span>
<span class="k">End</span> <span class="k">Sub</span>
</code></pre></div></div>

<p>In this example, the <code class="language-plaintext highlighter-rouge">PartNumber</code> variable is being evaluated.</p>

<p>The routine is checking for three different cases.</p>

<p>Next post will be about <strong><em>VBA Looping</em></strong>.</p>
:ET